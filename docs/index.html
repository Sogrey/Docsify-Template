<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>docsify-template - Docsify 模板项目</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <meta name="description" content="Docsify 模板项目">
  <meta name="viewport"
    content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <link rel="stylesheet" href="//unpkg.com/docsify/lib/themes/vue.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk/dist/gitalk.css">
  <link rel="icon" href="favicon.ico">
</head>

<body>
  <div id="app">
  </div>
  <!-- <div id="gitalk-container"></div> -->

  <script src="//unpkg.com/docsify/lib/docsify.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/docsify-copy-code"></script>
  <script src="//cdn.jsdelivr.net/npm/docsify/lib/plugins/gitalk.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.js"></script>
  <!--全文搜索,直接用官方提供的无法生效-->
  <script src="https://cdn.bootcss.com/docsify/4.5.9/plugins/search.min.js"></script>
  <script>
    window.$docsify = {
      el: '#app',
      logo: 'https://sogrey.top/img/logo/sogrey-undecided.png',
      name: 'docsify-template',
      repo: 'https://github.com/Sogrey/Docsify-Template',
      loadSidebar: '_sidebar.md', //左侧目录
      loadNavbar: '_navbar.md', //菜单栏
      coverpage: { //封面
        '/': '_coverpage.md'
      },
      subMaxLevel: 2,
      alias: {
        // '/_sidebar.md': '/sidebar.md'
      },
      auto2top: true,
      homepage: 'README.md',
      // docsify-copy-code (defaults)
      copyCode: {
        buttonText: 'Copy to clipboard',
        errorText: 'Error',
        successText: 'Copied'
      }
    }

    window.onload = function () {
      var mainContent = document.getElementById("main");
      //获取div  
      var divParent = mainContent.parentNode;

      //换行  
      var div = document.createElement("div");
      div.id = "gitalk-container";
      div.style = "margin: 0 80px 50px;";
      divParent.appendChild(div);

      initGitalk();
    }

    // window.addEventListener('hashchange', function () {
    //   /* things */
    //   initGitalk();
    // });

    //监听触发操作
    function hashChangeFire() {
      var gitalkContainer = document.createElement("gitalk-container");
      if (gitalkContainer) {
        gitalkContainer.innerHTML = "<div>Loading...</div>";
      }
      setTimeout(() => {
        initGitalk()
      }, 1000);
    }

    //url变化监听器
    if (('onhashchange' in window) && ((typeof document.documentMode === 'undefined') || document.documentMode == 8)) {
      // 浏览器支持onhashchange事件
      window.onhashchange = hashChangeFire; // TODO，对应新的hash执行的操作函数
    } else {
      // 不支持则用定时器检测的办法
      setInterval(function () {
        // 检测hash值或其中某一段是否更改的函数， 在低版本的iE浏览器中通过window.location.hash取出的指和其它的浏览器不同，要注意
        var ischanged = isHashChanged();
        if (ischanged) {
          hashChangeFire(); // TODO，对应新的hash执行的操作函数
        }
      }, 150);
    }

    var titleOld = "docsify-template";
    var gitalk;

    function initGitalk() {
      var mainContent = document.getElementById("main");
      var H1s = mainContent.querySelectorAll('h1');
      if (H1s.length > 0) {
        var h1 = H1s[0];
        var title = h1.id;
        console.log(title);
        if (titleOld != title && title != 'docsify-template') {
          titleOld = title;
          gitalk = new Gitalk({
            clientID: '2eea8db1d15a57751622',
            clientSecret: '91e8bdf9843aaa0cb793bcb83795fa199549795f',
            repo: 'Docsify-Template',
            owner: 'Sogrey',
            admin: ['Sogrey'],
            title: title,
            id: title, // Ensure uniqueness and length less than 50
            distractionFreeMode: false // Facebook-like distraction free mode
          })
          gitalk.render('gitalk-container');
        }
      }
    }
  </script>
</body>

</html>